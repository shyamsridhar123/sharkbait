# Implement Orchestrator agent

| Field | Value |
|-------|-------|
| ID | SB-005.01 |
| Parent | SB-005 |
| Status | todo |
| Priority | high |
| Created | 2025-01-13 |
| Updated | 2026-01-28 |

## Description

Central coordinator agent with **dual-ledger progress tracking** (inspired by Magentic-One):

**Core Responsibilities:**
- Task classification and routing
- Agent delegation decisions
- **Dual-ledger progress tracking (Task + Progress)**
- **Stall detection and recovery**
- Result aggregation
- User interaction management

**Dual-Ledger System:**
- `TaskLedger`: Objective, facts, assumptions, plan (outer loop)
- `ProgressLedger`: Current step, step history, stall count (inner loop)

**Stall Recovery Strategies:**
| Stall Type | Detection | Recovery |
|------------|-----------|----------|
| Agent loops | Same tool 3x | Force agent switch |
| No progress | 3 steps without advancement | Re-plan |
| Repeated failures | Same error 2x | Update assumptions |
| Resource blocked | Access denied | Escalate to user |

Tool Set: All tools + dispatch_agent

## Acceptance Criteria

- [ ] Task intent classification
- [ ] Smart agent selection
- [ ] **TaskLedger management (facts, assumptions, plan)**
- [ ] **ProgressLedger tracking (step history, stall count)**
- [ ] **Stall detection with configurable threshold**
- [ ] **Recovery strategies (re-plan, agent switch, escalate)**
- [ ] Parallel task coordination
- [ ] Progress reporting
- [ ] Graceful failure handling

## References

- AGENT_ARCHITECTURE.md Section 4.1.1: Dual-Ledger Progress Tracking
